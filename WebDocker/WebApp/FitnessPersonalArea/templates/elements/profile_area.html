{% block personal_area_profile %}
{% load static %}
{% load i18n %}
    <div class="page-header">
        <h2>{% trans 'Ваш профиль' %}</h2>
    </div>
    <hr>
    <div class="row" style="padding-bottom: 20px">

        <div class="col-md-6 col-lg-6 col-sm-12 avatar" ><!--left col-->
            {% if fitness_user.fitness_user_photo %}
                <img src="/media/{{ fitness_user.fitness_user_photo }}" class="avatar" alt="avatar">

            {% else %}
                <img src="{% static 'images/def_profile_image.png' %}" alt="{{ user.username }}" class="rounded-0">


                <h6>{% trans "Загрузите свою фотографию" %}...</h6>
                <form action method="post"  enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" accept="image/jpeg,image/png,image/gif" class="text-center center-block file-upload" required>
                    <button type="submit">{% trans "Обновить фотографию" %}</button>
                </form>
            {% endif %}
            <br>
        </div>
        <div class="col-md-6 col-lg-6 col-sm-12" ><!--right col-->
            <h3>{{ user.first_name }} {{ user.last_name }} </h3>

            <p class="font-weight-light">via <strong>{{ user.username }}  </strong>
            <hr>
            <dl class="row">
                <dt class="col-sm-4">{% trans "Дата рождения" %} </dt>
                <dd class="col-sm-8">{{ fitness_user.fitness_user_bdate }} </dd>

                <dt class="col-sm-4">{% trans "Тип аккаунта" %}</dt>
                <dd class="col-sm-8">{{ fitness_user.get_fitness_user_type_display }}</dd>

                <dt class="col-sm-4">{% trans "Пол" %}</dt>
                <dd class="col-sm-8">{{ fitness_user.get_fitness_user_gender_display }}</dd>

                <dt class="col-sm-4">{% trans "Город" %} </dt>
                <dd class="col-sm-8">{{ fitness_user.fitness_user_destination_city }}</dd>
            </dl>


        </div>

    </div>

    <div class="card">
        <h5 class="card-header">{% trans "Ваши залы" %} <i class="fas fa-plus-square"></i></h5>
        <div class="card-body">
            <div class="row">
                {% for gym in user_gyms %}
                    <div class="col-lg-3 col-md-6 col-sm-12">
                        <div class="card" style="width: 15rem; height: 240px">
                          <div class="card-body">
                            <h5 class="card-title">{{ gym.gym_name }} [ДОЛЖНА БЫТЬ ССЫЛКА НА СТАРНИЦУ ЗАЛА С КАРТОЙ]<i class="fas fa-map-marker-alt"></i></h5>
                            <h6 class="card-subtitle mb-2 text-muted">{{ gym.gym_destination }}</h6>
                            <p class="card-text">{{ gym.gym_short_description }}</p>

                            <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                          </div>
                        </div>
                    </div>
                {% empty %}
                    {% trans 'Нет ваших залов, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card">
        <h5 class="card-header">{% trans "Ваши тренеровки" %} <i class="fas fa-plus-square"></i></h5>
        <div class="card-body">
            <div class="row">
                {% for train in user_training_schedule %}
                    <div class="col-lg-3 col-md-6 col-sm-12">
                        <div class="card" style="width: 15rem; height: 270px">
                            <div class="card-body">
                                <h5 class="card-title">{{ train.schedule_date }} {% trans "в" %} {{ train.gym_short }} [ДОЛЖНА БЫТЬ ССЫЛКА НА СТАРНИЦУ ЗАЛА С КАРТОЙ]<i class="fas fa-map-marker-alt"></i></h5>
                                <h6 class="card-subtitle mb-2 text-muted">{{ train.schedule_train_type }}</h6>

                                {% if train.schedule_exercise_set %}

                                    <p class="card-text"><strong>{% trans 'План' %}</strong>: {{ train.schedule_exercise_set.short_title }}</p>

                                {% endif %}

                                <p class="card-text">{% trans 'С' %} {{ train.schedule_train_start }} {% trans 'до' %} {{ train.schedule_train_end }} <i class="fas fa-clock"></i></p>

                                {% if train.get_all_tags %}
                                    <h6 class="card-subtitle mb-2 text-muted"><strong>{% trans 'Теги' %}</strong>: {{ train.get_all_tags }}</h6>
                                {% endif %}

                                <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    {% trans 'Нет тренеровок в расписании, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endfor %}
            </div>
        </div>
    </div>


    <div class="card">
        <h5 class="card-header">{% trans "Ваши фотографии" %} <i class="fas fa-plus-square"></i></h5>
        <div class="card-body">
            <div class="row">
                {% for photo in user_projection_photos %}
                    <div class="col-lg-3 col-md-6 col-sm-12">
                        <div class="card" style="width: 12rem; height: 360px">
                            <img class="card-img-top" height="220px" width="100%" src="/media/{{ photo.projection_view_photo }}" alt="Card image cap">
                            <div class="card-body">
                                <h5 class="card-title">{{ photo.get_projection_view_type_display }}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">{{ photo.projection_view_date }}</h6>


                                <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    {% trans 'Нет фотографий, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endfor %}
            </div>
        </div>
    </div>


    <div class="card">
        <h5 class="card-header"><i class="fas fa-notes-medical"></i> {% trans "Ваши записи" %} <i class="fas fa-plus-square"></i></h5>
        <div class="card-body">
            <div class="row">
                {% for medical_note in user_medical_notes %}
                    <div class="col-lg-3 col-md-6 col-sm-12">
                        <div class="card" style="width: 15rem; height: 240px">
                          <div class="card-body">
                            <h5 class="card-title">{{ medical_note.short_title }}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">{{ medical_note.medical_note_datetime }}</h6>
                            <p class="card-text">{{ medical_note.short_text }}</p>

                              {% if medical_note.medical_note_tags %}
                                    <h6 class="card-subtitle mb-2 text-muted"><strong>{% trans 'Теги' %}</strong>: {{ medical_note.get_all_tags }}</h6>
                              {% endif %}
                            <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                          </div>
                        </div>
                    </div>
                {% empty %}
                    {% trans 'Нет ваших записей, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endfor %}
            </div>
        </div>
    </div>


    <div class="card">
        <h5 class="card-header"><i class="fas fa-book-open"></i> {% trans "Ваш дневник" %} <i class="fas fa-plus-square"></i></h5>
        <div class="card-body">
            <div class="row">
                {% for usual_note in user_usual_notes %}
                    <div class="col-lg-3 col-md-6 col-sm-12">
                        <div class="card" style="width: 15rem; height: 240px">
                          <div class="card-body">
                            <h5 class="card-title">{{ usual_note.short_title }}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">{{ usual_note.diary_note_datetime }}</h6>
                            <p class="card-text">{{ usual_note.short_text }}</p>

                              {% if usual_note.diary_note_tags %}
                                    <h6 class="card-subtitle mb-2 text-muted"><strong>{% trans 'Теги' %}</strong>: {{ usual_note.get_all_tags }}</h6>
                              {% endif %}

                            <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                          </div>
                        </div>
                    </div>
                {% empty %}
                    {% trans 'Нет ваших записей, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endfor %}
            </div>
        </div>
    </div>

    {% if not fitness_trainer %}

        <div class="card">
            <h5 class="card-header">{% trans "Ваши контракты" %} <i class="fas fa-plus-square"></i></h5>
            <div class="card-body">
                <div class="row">
                    {% for contract in user_train_contracts %}
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="card"
                                 style="width: 17rem;
                                        height: 250px;
                                        background-color:
                                        {% if not contract.contract_trainer_start %}
                                            #ff0000ad;
                                        {% elif not contract.contract_ward_start %}
                                             #ff0000ad;
                                        {% elif not contract.contract_trainer_end and not contract.contract_ward_end %}
                                             #008000c4;
                                        {% else %}
                                            #ff8f00a3;
                                        {% endif %}


                                         ">
                                <div class="card-body">
                                    <p class="card-text"><strong>{% trans 'Тренер' %}</strong>: {{ contract.contract_trainer_user.user.user.first_name }} {{ contract.contract_trainer_user.user.user.last_name }}</p>
                                    <p class="card-text"><strong>{% trans 'Подопечный' %}</strong>: {{ contract.contract_ward_user.user.first_name }} {{ contract.contract_ward_user.user.last_name }}</p>

                                    <p class="card-text"><strong>{% trans 'Цена' %}</strong>: {{ contract.contract_hour_price }} {{ contract.contract_currency }}</p>

                                    <p class="card-text"><strong>{% trans 'Начало' %}</strong>: {{ contract.contract_create_datetime }}</p>

                                    <p class="card-text"><strong>{% trans 'Окончание' %}</strong>: {{ contract.contract_expire_datetime }}</p>

                                    <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        {% trans 'Нет контрактов, создайте.' %} <i class="fas fa-plus-square"></i>
                    {% endfor %}
                </div>
            </div>
        </div>

    {% endif %}


    {% if fitness_trainer %}

        <div class="card">
            <h5 class="card-header">{% trans "Данные тренера" %}</h5>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <strong>
                            {% trans "Занятость тренера"%}
                        </strong>:
                        {% if fitness_trainer.trainer_employment_status %}
                            Занят
                        {% else %}
                            Свободен
                        {% endif %}
                    </li>
                    <li class="list-group-item small_text">
                        <strong>
                            {% trans "Описание тренера"%}
                        </strong>: {{ fitness_trainer.trainer_description }}</li>
                </ul>
            </div>
        </div>


        <div class="card">
            <h5 class="card-header">{% trans "Расценки тренера" %}
                <button type="button" class="btn btn-light" data-toggle="modal"
                        data-target="#priceEdit">
                    <i class="fas fa-plus-square "></i>
                </button>
            </h5>
            <div class="card-body">
                {% if fitness_trainer_price %}
                    <div style="overflow-x:auto;">
                        <table class="table  table-striped table-bordered" id="trainer_prices_table">
                            <thead class="thead-light">
                            <tr>
                                <th scope="col" hidden>№</th>
                                <th scope="col">{% trans "Цена/час" %}</th>
                                <th scope="col">{% trans "Валюта" %}</th>
                                <th scope="col">{% trans "Торг" %}</th>
                                <th scope="col">{% trans "Актуальность" %}</th>
                                <th scope="col">{% trans "Коментарий" %}</th>
                                <th scope="col">{% trans "Редактирование" %}</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for price in fitness_trainer_price %}
                                <tr>
                                    <td hidden>{{ price.id }}</td>
                                    <td>{{ price.trainer_price_hour }}</td>
                                    <td>{{ price.trainer_price_currency }}</td>
                                    <td>
                                        {% if price.trainer_price_bargaining %}
                                            <p hidden>True</p>
                                            <i class="fas fa-check-circle" style="color: green"></i>
                                        {% else %}
                                            <i class="fas fa-times-circle" style="color: red"></i>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if price.trainer_price_actuality %}
                                            <p hidden>True</p>
                                            <i class="fas fa-check-circle" style="color: green"></i>
                                        {% else %}
                                            <i class="fas fa-times-circle" style="color: red"></i>
                                        {% endif %}
                                    </td>
                                    <td>{{ price.trainer_price_comment }}</td>
                                    <td>
                                        <button type="button" class="btn btn-outline-primary" id="price_edit_btn" data-toggle="modal"
                                                data-target="#priceEdit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    {% trans 'Нет активных расценок, добавьте.' %} <i class="fas fa-plus-square"></i>
                {% endif %}
            </div>
        </div>

        {% block price_edit %}

            {% include 'elements/modal/price_edit_modal.html' %}

        {% endblock %}


        <div class="card">
            <h5 class="card-header">{% trans "Ваши контракты" %} <i class="fas fa-plus-square"></i></h5>
            <div class="card-body">
                <div class="row">
                    {% for contract in fitness_trainer_contracts %}
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="card"
                                 style="width: 17rem;
                                        height: 250px;
                                        background-color:
                                        {% if not contract.contract_trainer_start %}
                                            #ff0000ad;
                                        {% elif not contract.contract_ward_start %}
                                             #ff0000ad;
                                        {% elif not contract.contract_trainer_end and not contract.contract_ward_end %}
                                             #008000c4;
                                        {% else %}
                                            #ff8f00a3;
                                        {% endif %}


                                         ">
                                <div class="card-body">
                                    <p class="card-text"><strong>{% trans 'Тренер' %}</strong>: {{ contract.contract_trainer_user.user.user.first_name }} {{ contract.contract_trainer_user.user.user.last_name }}</p>
                                    <p class="card-text"><strong>{% trans 'Подопечный' %}</strong>: {{ contract.contract_ward_user.user.first_name }} {{ contract.contract_ward_user.user.last_name }}</p>

                                    <p class="card-text"><strong>{% trans 'Цена' %}</strong>: {{ contract.contract_hour_price }} {{ contract.contract_currency }}</p>

                                    <p class="card-text"><strong>{% trans 'Начало' %}</strong>: {{ contract.contract_create_datetime }}</p>

                                    <p class="card-text"><strong>{% trans 'Окончание' %}</strong>: {{ contract.contract_expire_datetime }}</p>

                                    <a href="#" class="card-link">{% trans 'Подробнее' %}</a>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        {% trans 'Нет контрактов, создайте.' %} <i class="fas fa-plus-square"></i>
                    {% endfor %}
                </div>
            </div>
        </div>



        {% if fitness_trainer_docs %}

                <div class="card">
                    <h5 class="card-header">{% trans "Документы тренера" %}  <i class="fas fa-plus-square"></i></h5>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">

                            {% for doc in fitness_trainer_docs %}

                                <li class="list-group-item small_text">
                                    {{ doc.doc_title }}
                                    <br>
                                    <button type="button" class="btn btn-link">
                                        <a href="/media/{{ doc.doc_file }}">
                                            {% trans "Скачать документ" %} - {{ doc.filename }}
                                        </a>
                                    </button>
                                </li>


                            {% endfor %}

                        </ul>
                    </div>
                </div>

        {% endif %}

    {% endif %}

    <script>
        jQuery(document).ready(function(){
             $("#trainer_prices_table").on('click','.btn.btn-outline-primary',function(){
                var currentRow=$(this).closest("tr");
                var userId=currentRow.find("td:eq(0)").text(); // get current row 1st TD value
                var price=currentRow.find("td:eq(1)").text();
                var currency=currentRow.find("td:eq(2)").text();
                var bargain=currentRow.find("td:eq(3)").text();
                var actual=currentRow.find("td:eq(4)").text();
                var comment=currentRow.find("td:eq(5)").text();

                $("#price_id_modal").val(userId);
                $("#price_modal").val(parseFloat(price));
                $("#price_comment_modal").val(comment);
                $("#price_currency_modal").val(currency);

                $("#price_bargain_modal").prop('checked', false);
                $("#price_actual_modal").prop('checked', false);
                if (bargain.includes('True')){
                    $("#price_bargain_modal").prop('checked', true);
                }
                if(actual.includes('True')){
                    $("#price_actual_modal").prop('checked', true);
                }
            });
             $("#new_trainer_price").click(function(){

                $("#price_id_modal").val(0);
                $("#price_modal").val(0);
                $("#price_comment_modal").val("");
                $("#price_currency_modal").val("");

                $("#price_bargain_modal").prop('checked', false);
                $("#price_actual_modal").prop('checked', false);
            });
        });

        </script>
{% endblock %}